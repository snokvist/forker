# Cleaned WFB config for forker
# All options in [general] can be overridden per [instance] if needed.

[general]
wfb_nics=wlan0,wlan1
wfb_tx=wlan0

# If using aggregators, a master node (ground station) may be needed.
master_node=192.168.2.20

fec_n=12
fec_k=8
mcs=2
tx_rcv_buf_size=2097152
rx_snd_buf_size=2097152
log_interval=1000

wifi_channel=165
stbc=1
ldpc=1
bandwidth=20
wifi_region=US
wifi_txpower=1500

key_file=/etc/gs.key

# Optional SSE wrapper used per-instance when sse=yes.
# Leave sse_tail blank to disable SSE globally.
sse_tail=/usr/local/bin/sse_tail
sse_host=0.0.0.0
sse_base_port=18080


# ----------------------------------------------------------------------
# VIDEO DOWNLINK (RX) PATH
# ----------------------------------------------------------------------

[instance master-video-rx]
type=aggregator
direction=rx
# UDP output to local Display/Decoder
output=udp://192.168.2.20:5600
# Aggregator listen port for remote forwarders
input=127.0.0.1:5500
linkid=7669206
sse=yes

[instance video-fwd]
type=forwarder
direction=rx
# Forward radio RX to the master-video-rx aggregator (above)
output=127.0.0.1:5500
linkid=7669206
sse=yes


# ----------------------------------------------------------------------
# TUNNEL (L3) OVER WFB
# ----------------------------------------------------------------------

[instance tunnel]
type=tunnel
# wfb_tun parameters
ifname=gs-wfb
ifaddr=10.5.0.1/24
input_port=5450
output_port=5451
tx_name=tunnel-tx
rx_name=tunnel-rx
sse=no

# RX side: WFB RX aggregator feeding the tunnel
[instance master-tunnel-rx]
type=aggregator
direction=rx
# Aggregator listen port for RX forwarders
input=127.0.0.1:5401
# Where to send packets so wfb_tun receives them
output=127.0.0.1:5450
linkid=0x000001
sse=yes

# TX side: local TX that pulls packets from wfb_tun
[instance master-tunnel-tx]
type=local
direction=tx
# UDP input from wfb_tun back towards the radio link
input=127.0.0.1:5451
control_port=4000
linkid=0x000001
sse=yes

# RX forwarder from radio into the tunnel aggregator
[instance tunnel-rx]
type=forwarder
direction=rx
# Forward radio RX into master-tunnel-rx (aggregator at 5401)
output=127.0.0.1:5401
linkid=0x000001
sse=yes

# TX instance taking UDP from the tunnel aggregator and sending via radio
[instance tunnel-tx]
type=local
direction=tx
# UDP input from master-tunnel-tx / other upstream
input=127.0.0.1:5401
control_port=5100
linkid=0x000001
sse=yes

